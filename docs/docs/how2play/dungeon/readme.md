# 随机地牢

本质上是一个 Roguelike 玩法

虽然名字叫地牢，但实际上大地图攻略也使用相同的模式

## 撤离

对于大地图攻略，以及主动探险类的地牢，可以中途撤离，此时会保留到目前为止的物品。

对于某些剧情类地牢，可能无法中途撤离。

## 战败惩罚

通关失败会失去所有体力，并重新在上一个存档地点醒来，可能是自己家，或者是距离最近的据点的旅馆中。

除此之外没有其他惩罚。

每个月挑战地牢有次数限制。如果挑战失败，就只能下个月再重新尝试。

## 地牢设计

地牢是一个 3×5×5×3×5×5 的六边形场地。
所有的地牢都会有三个门通向下一个地块。

如果是当前层的地牢出口，则其中一个门可以离开地牢，另两个门则前往下一层。

地牢层数为 1-20 层。每层对应修为等级的 5 级。例如第一层地牢遇到的敌人，强度在 0-5 之间。

## 地图生成算法

已经通过的房间数，称之为 R 值，初始为 0。

生成房间时，要提供 R 值。生成完毕 R 值 + 1。

R 值为 0 代表初始房间，初始房间是空的，没有任何遭遇。

所有的房间（包括初始房间）固定有三个出口，默认情况下：

出口 1：下一个房间是宝箱、npc 或事件
出口 2：下一个房间是普通敌人
出口 3：下一个房间是随机房间，可能是精英敌人、普通敌人，所有类型的非敌人房间。
只有在随机房间能遇到隐藏宝箱、隐藏 npc 和隐藏事件。

当 (R + 1) % 3 == 0 时，房间只有一个出口，且必然是精英敌人。
精英敌人会掉落一张他所拥有的的卡牌。

当 (R + 1) % 3 == 0 且已经击败过两次精英敌人后，下一个房间只有一个出口，且必然是 Boss。

Boss 房间仍然有三个出口，中间的出口可以离开地牢。另外两个则是进入下一层。

### 宝箱

装备
秘籍
材料
隐藏宝箱

### npc

治疗
商人
赌博
工匠
修炼台，升级卡牌
隐藏 npc

### 事件

获得 Buff
获得 Debuff
获得卡牌升级
获得法宝
隐藏事件

### 敌人

有敌人的房间，必须消灭敌人才能进入下一层

普通敌人：等级 = 当前层 × 5 - 10
精英敌人：等级 = 当前层 × 5 - 5
