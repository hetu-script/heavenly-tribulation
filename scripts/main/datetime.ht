
/// 当前年数
function toYear(timestamp) => (timestamp ~/ Constants.ticksPerYear)
/// 0-11 当前月数
function toMonth(timestamp) => (timestamp % Constants.ticksPerYear) ~/ Constants.ticksPerMonth
/// 0-29 当前月的天数
function toDay(timestamp) => (timestamp % Constants.ticksPerMonth) ~/ Constants.ticksPerDay
/// 0-3 当前的时刻（清晨、下午、傍晚、午夜）
function toTime(timestamp) => (timestamp % Constants.ticksPerDay) ~/ Constants.ticksPerTime

function getDateTimeString(timestamp) {
  return formatDateTimeString(timestamp, format: 'datetime.ymdh')
}

/// [format] = ('age' | 'date' | 'time' | 'datetime' | 'number').('ymdh' | 'ymd' | 'ym' | 'md' | 'y' | 'm' | 'd' | 'h')
function formatDateTimeString(timestamp: integer, {format: string}) {
  let yearN = toYear(timestamp)
  let monthN = toMonth(timestamp)
  let dayN = toDay(timestamp)
  let timeN = toTime(timestamp)
  
  let yearC = ''
  let monthC = ''
  let dayC = ''

  const t = format?.split('.').first ?? 'date'
  if (t == 'age') {
    yearC = engine.locale('ageYear')
    monthC = engine.locale('ageMonth')
    dayC = engine.locale('ageDay')
  } else if (t == 'date' || t == 'datetime') {
    yearC = engine.locale('dateYear')
    monthC = engine.locale('dateMonth')
    dayC = engine.locale('dateDay')
    ++yearN
    ++monthN
    ++dayN
    ++timeN
  } else if (t == 'time') {
    yearC = engine.locale('timeYear')
    monthC = engine.locale('timeMonth')
    dayC = engine.locale('timeDay')
  }

  const y = '${yearN}${yearC}'
  const m = '${monthN}${monthC}'
  const d = '${dayN}${dayC}'
  const h = engine.locale('timeOfDay${timeN}')

  const fmt = format?.split('.').last ?? 'ymdh'
  switch (fmt) {
    'y' : {
      return y
    }
    'm' : {
      return m
    }
    'd' : {
      return d
    }
    'h' : {
      return h
    }
    'ym' : {
      return '${y}${m}'
    }
    'md' : {
      return '${m}${d}'
    }
    'ymd' : {
      return '${y}${m}${d}'
    }
    'ymdh' : {
      return '${y}${m}${d}${h}'
    }
    'age' : {
      if (yearN == 0) {
        if (monthN == 0) {
          return d
        } else {
          return m
        }
      } else {
        return y
      }
    }
  }
}

function formatTimeString(timestamp) => formatDateTimeString(timestamp, format: 'time.ymd')

function formatAgeString(timestamp) => formatDateTimeString(timestamp, format: 'age')

// function formatAge(timestamp) => formatDateTimeString(timestamp, format: 'number.y')

function getDayString(count) {
  assert(count > 0)
  return '${count} ${engine.locale('timeDay')}'
}

function getMonthString(count) {
  assert(count > 0)
  return '${count} ${engine.locale('timeMonth')}'
}

function getYearString(count) {
  assert(count > 0)
  return '${count} ${engine.locale('timeYear')}'
}
